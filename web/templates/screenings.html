{% extends "base.html" %}

{% block title %}Screenings - Sydney Cinema Booking System{% endblock %}

{% block content %}
<div class="screenings-page-section">
    <div class="container">
        <h1 class="section-title text-center mb-5">Movie Screenings</h1>
        
        <div id="screenings-list" class="row row-cols-1 g-4">
            <!-- Screenings will be loaded here by JavaScript -->
        </div>
        
        <div id="loading-screenings" class="text-center mt-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2 text-muted">Loading screenings...</p>
        </div>
        
        <div id="no-screenings" class="text-center mt-5 d-none">
            <p class="lead text-muted">No screenings found.</p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.screenings-page-section {
    padding: 60px 0;
    background-color: var(--primary-dark);
}

.screening-card {
    background-color: var(--card-bg);
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    overflow: hidden;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    border: 1px solid var(--border-color);
    margin-bottom: 20px;
}

.screening-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
}

.screening-header {
    background: linear-gradient(90deg, var(--accent-gold), #e6b800);
    color: var(--primary-dark);
    padding: 15px 20px;
    font-weight: bold;
}

.screening-body {
    padding: 20px;
    color: var(--text-light);
}

.screening-info h5 {
    color: var(--accent-gold);
    margin-bottom: 10px;
}

.screening-info p {
    margin-bottom: 5px;
    color: var(--text-light);
}

.btn-book {
    background-color: var(--button-primary-bg);
    color: var(--button-primary-text);
    border: none;
    padding: 10px 20px;
    border-radius: 25px;
    font-weight: bold;
    transition: all 0.3s ease;
    margin-right: 10px;
}

.btn-book:hover {
    background-color: #e6b800;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
}

.btn-book:disabled {
    background-color: var(--text-muted);
    color: var(--primary-dark);
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('Screenings page loaded');
    
    const screeningsList = document.getElementById('screenings-list');
    const loadingScreenings = document.getElementById('loading-screenings');
    const noScreenings = document.getElementById('no-screenings');
    
    // Load screenings
    fetch('/api/screenings?date=2025-10-26')
        .then(response => response.json())
        .then(data => {
            console.log('Screenings data received:', data);
            loadingScreenings.classList.add('d-none');
            
            if (data.screenings && data.screenings.length > 0) {
                data.screenings.forEach(screening => {
                    const screeningCard = createScreeningCard(screening);
                    screeningsList.appendChild(screeningCard);
                });
            } else {
                noScreenings.classList.remove('d-none');
            }
        })
        .catch(error => {
            console.error('Error fetching screenings:', error);
            loadingScreenings.classList.add('d-none');
            noScreenings.classList.remove('d-none');
            noScreenings.innerHTML = '<p class="lead text-danger">Failed to load screenings. Please try again later.</p>';
        });
    
    function createScreeningCard(screening) {
        const col = document.createElement('div');
        col.className = 'col';
        
        const isAvailable = screening.available_seats > 0;
        const bookingButton = isAvailable 
            ? `<a href="/book_ticket/${screening.screening_id}" class="btn btn-book">
                 <i class="fas fa-ticket-alt me-2"></i>Book Now
               </a>`
            : `<button class="btn btn-book" disabled>
                 <i class="fas fa-times me-2"></i>Sold Out
               </button>`;
        
        col.innerHTML = `
            <div class="screening-card">
                <div class="screening-header">
                    <i class="fas fa-calendar-alt me-2"></i>
                    ${screening.screening_date} at ${screening.start_time}
                </div>
                <div class="screening-body">
                    <div class="screening-info">
                        <h5>${screening.title}</h5>
                        <p><strong>Cinema:</strong> ${screening.cinema_name}</p>
                        <p><strong>Location:</strong> ${screening.suburb}</p>
                        <p><strong>Screen:</strong> Screen ${screening.screen_number} (${screening.screening_type})</p>
                        <p><strong>Price:</strong> $${screening.ticket_price.toFixed(2)}</p>
                        <p><strong>Seats:</strong> ${screening.available_seats} / ${screening.total_seats} available</p>
                        <p><strong>Duration:</strong> ${screening.start_time} - ${screening.end_time}</p>
                    </div>
                    <div class="screening-actions mt-3">
                        <a href="/screening/${screening.screening_id}" class="btn btn-outline-primary me-2">
                            <i class="fas fa-info-circle me-1"></i>View Details
                        </a>
                        ${bookingButton}
                    </div>
                </div>
            </div>
        `;
        
        return col;
    }
});
</script>
{% endblock %}